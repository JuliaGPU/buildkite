version: "3.8"

# an Intel NUC 11 (NUC11PAHi7) containing a i7-1165G7 (8 threads) with 32GiB RAM

services:
  buildkite:
    hostname: draco.maleadt.net
    build:
      context: ../../image/
      args:
        base: intel/oneapi
    devices:
      - "/dev/dri:/dev/dri"
    environment:
      JULIA_NUM_THREADS: 8
    env_file: ../token.env
    command:
      - start
      - --disconnect-after-job
      - --hooks-path=/hooks
      - --tags=queue=juliagpu,intel=gen12
      - --name=draco.maleadt.net
    volumes:
      - /home/buildkite:/root
